import { getGumroadSales } from '../lib/analytics/gumroadPull.js'; import { getLemonSales } from '../lib/analytics/lemonPull.js'; import { notionLog } from '../lib/notionSync.js'; import { db } from '../lib/tracking.js'; import { seedAudience } from '../lib/metaSeed.js'; async function main(){ const gum=await getGumroadSales(); const lem=await getLemonSales(); const all=[...gum,...lem]; if(!all.length){ console.log('[sync] No new sales'); return;} const conn=await db(); const emails:string[]=[]; for(const s of all){ await conn.run('INSERT OR REPLACE INTO sales(id,sku,amount_cents,created_at) VALUES(?,?,?,?)', s.created_at, s.sku, s.amount_cents, s.created_at); await notionLog({ sku:s.sku, title:s.title, platform:s.platform, price_cents:s.amount_cents, sales:1, revenue:s.amount_cents/100, cr:0.0 }); if(s.email) emails.push(s.email); } if(emails.length) await seedAudience(emails); console.log(`[sync] Updated ${all.length} sales â†’ Notion + Meta`);} main();
